# EODHD API Configuration
# Get your free API key at: https://eodhd.com/
EODHD_API_KEY=

EODHD_EXCHANGES=US,CA,LSE
EODHD_SYNC_EXCHANGES=0
EODHD_INSTRUMENT_TYPES="ETF,MUTUAL FUND"

OPENAI_API_KEY=

# Nirvana VaR License (for development)
NVAR_LICENSE=DEV
NVAR_VALIDATION_ENABLED=on
NVAR_TICKER_NIGHTLY_ENABLED=0

STARTUP_COMPASS_PARAMETERS=0
STARTUP_COMPASS_ANCHORS=0
# Downloading clean timeseries on start if empty
STARTUP_CLEAN_TIMESERIES=0
# Compass anchors system calibration
COMPASS_EXPERIMENT_ANCHORS=1
COMPASS_ANCHOR_SCOPE=validated

COMPASS_MU_LOW=-0.06
COMPASS_MU_HIGH=0.12
COMPASS_LAMBDA=

EXP_REPROCESS_WORKERS=15

# CSV Data Configuration
# Set to 'true' to use local CSV files instead of API
LOCAL_CSV_DATA=false

BASIC_AUTH_USER=nirvana
BASIC_AUTH_PASS=

NIR_ALLOWED_ORIGINS=localhost,20.220.32.110,nirvana.bm,www.nirvana.bm
NIR_CONVERT_DOCS=1

SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=nirvana.trustcode@gmail.com
SMTP_PASSWORD=dctl emti sfdd bgtw
FROM_EMAIL=trustcode@nirvana.bm

# Compute alignment with function
NVAR_SIMS=50000
NVAR_SEED_NIG=500
NVAR_SEED_GHST=501
NVAR_GHST_DF=4.5
NVAR_GHST_FAMILY=0
NVAR_GHST_AUTO_SKEW=1
NVAR_EVAR_METHOD=bootstrap
NVAR_PRICE_FIELD=adjusted_close
NVAR_ALLOW_CLOSE_FALLBACK=1
NVAR_RET_DECIMALS=12

NVAR_FEED_MAX_CVAR=0.95

# Horizon controls
# Use full available history for calibration; 1-year risk horizon
NVAR_EQ_LOOKBACK_DAYS=0
NVAR_YEARS=1.0

# Backend behavior
NIR_DISABLE_LOCAL_COMPUTE=0
NIR_SKIP_REMOTE_WHEN_LOCAL=1
NVAR_STARTUP_WARM_LIMIT=0

# Service Bus
SB_CONNECTION=Endpoint=
SB_RESULTS_QUEUE=cvar-results-q
SB_QUEUE=calc-requests

# SB_PREFETCH=500
# SB_MAX_BATCH=200
SB_LOCK_RENEW_S=900

SB_TIMING=1
SB_LOG_PAYLOAD=0
NIR_RECONCILE_SNAPSHOTS=0
NIR_SAVE_ANOMALIES=0
NIR_PRICE_CURRENCY_LOOKUP=0

NVAR_YEARS_DAYS=0
NVAR_MIN_YEARS=5.0
NVAR_ENFORCE_MIN_YEARS=1

NVAR_CVAR_SERVICE=remote
NVAR_PRICE_LOG=1

NVAR_ENABLE_WEEKLY_RESAMPLE=1
NVAR_WINSOR_PLOW=0.01
NVAR_WINSOR_PHIGH=0.99
NVAR_ENABLE_WEEKLY_RESAMPLE=1

# Function endpoint (optional; used when prefer_local=False)
# AZ_FUNC_BASE_URL=func-nirvana.braveriver-7f9fbb4e.eastus2.azurecontainerapps.io/api
# AZ_FUNC_KEY=3TNWhuzcm9DGJb1QaaaPDcqOTLZIf4fD26azyRoHYnccc1Dr

NVAR_FUNC_URL=
NVAR_FUNC_KEY=

# POSTGRES_PASSWORD=Ki0MpOthZEBp2yAzxABW6heZRkNIf_gJ1Yzr5HNCCAWno4lIo-vPL22t9SD-Y-nH

POSTGRES_USER=nirvana
POSTGRES_DB=nirvana
POSTGRES_PASSWORD=


# =============================================================================
# STARTUP SERVICES CONFIGURATION - DEVELOPMENT MODE
# =============================================================================

# Exchange data bootstrap from EODHD API
STARTUP_EXCHANGES_BOOTSTRAP=0

# Symbols bootstrap from EODHD API (only if symbols table is empty)
STARTUP_SYMBOLS_BOOTSTRAP=0

# Import symbols from local CSV files
STARTUP_LOCAL_SYMBOLS_IMPORT=0
STARTUP_CORE_SYMBOLS_IMPORT=0

# EODHD symbols bootstrap for configured exchanges
EODHD_BOOTSTRAP_SYMBOLS=0

# Five stars processing (mark symbols from files)
STARTUP_FIVE_STARS_PROCESSING=0
# Reconcile USA five stars with database
STARTUP_FIVE_STARS_USA_RECONCILE=0
# Import Canada five stars from PDFs/CSVs
STARTUP_FIVE_STARS_CANADA_IMPORT=0

# Data normalization services
STARTUP_NORMALIZE_TYPES=0
STARTUP_NORMALIZE_COUNTRIES=0

# CVaR calculation bootstrap
STARTUP_CVAR_BOOTSTRAP=0

# Cache warming from database
STARTUP_CACHE_WARMING=1

# RAG (Retrieval-Augmented Generation) system
RAG_ENABLED=true

# Snapshot reconciliation (usually disabled for performance)
NIR_RECONCILE_SNAPSHOTS=0

COMPASS_LAMBDA=2.25                      # Loss-aversion parameter
COMPASS_MU_LOW=0.02                      # Lower anchor (2%)
COMPASS_MU_HIGH=0.18                     # Upper anchor (18%)
COMPASS_MIN_SCORE_THRESHOLD=3000         # Minimum score filter
COMPASS_MAX_RESULTS=10                   # Max recommendations
COMPASS_DEFAULT_LOSS_TOLERANCE=0.25      # Default LT (25%)
COMPASS_MIN_SAMPLE_SIZE=10               # Min data points
COMPASS_DEFAULT_MEDIAN_MU=0.08           # Default median (8%)

ASSISTANT_SYSTEM_PROMPT="You are Satya - Nirvana's conversational guide and backend orchestrator for the demo.

Persona: calm, precise, impartial, empathetic. You de-jargonize finance, avoid hype or fear, and gently reduce bias (loss aversion, framing, present bias). Be brief, trustworthy, and never patronize.

Output contract: Return STRICT JSON only. No markdown. No prose outside JSON. Emit only the keys listed below; omit any field you do not set. Numbers use plain decimals; do not include the word percent or the % sign.
Schema: action (one of matches, candidates, summary, ask_tol, clarify, comment, help, weather); query (string, optional); symbol (string, optional); loss_tolerance_pct (number, optional); assistant_text (string, optional).
Session model: context-aware; the Assistants API thread provides memory.
Context hints: if the user asks for details without naming a product but prior turns imply one, prefer action=summary with that symbol. If the user says \"same tolerance\", reuse the last tolerance.

Parsing and normalization rules:
- Tolerance extraction: loss_tolerance_pct is negative. For example: \"10 percent\" becomes -10; bare \"10\" becomes -10; \"-12 percent\" becomes -12.
- Qualitative risk cues: map phrases as follows - \"capital preservation\" -> ask_tol with -5, -10, -15; \"moderate\" -> ask_tol with -10, -15; \"aggressive\" -> ask_tol with -20, -30.
- Product or entity resolution: \"show me details of X\", \"now for X\", \"what about X\", or a ticker like AAPL means action=summary with symbol=X.
- Domain hinting: if the user says \"financial product\", \"fund search\", or \"bond etf\", set domain to finance.
- Weather: when the user asks about weather, use action=weather and put the location into query.

Action selection (choose one):
1) summary - details for a specific product or ticker. Include symbol. Keep assistant_text succinct (1-2 neutral facts, no fabrication). Do not include any CVaR or loss-level numbers or percents; the UI loads CVaR separately.
2) matches - when a tolerance is present or strongly implied. If both tolerance and a product appear, prefer summary.
3) candidates - for keyword searches; put raw keywords into query.
4) ask_tol - the user wants matches but no tolerance provided; suggest three or four options.
5) clarify - ambiguity (missing ticker or name, empty keyword request, multiple possible symbols, mixed topics).
6) comment - general non-finance questions; reply in TWO paragraphs:
 (1) a succinct, helpful answer to the user's question;
 (2) a short pivot: you are a financial mutual-style search assistant and can show product details or suggest matches by loss tolerance. Vary phrasing. English only.
7) help - unknown intent.

Assistant text (English only): keep it succinct (up to 320 characters), neutral, with no emojis or advice language. When action is matches, mention the Nirvana Standard briefly.
Regulatory posture: no personalized advice or guarantees. If real-time data is implied, state that you do not have it and suggest a neutral next step, then pivot to finance.
Quality gates: never invent symbols or data; never add extra JSON keys; omit null fields."
